<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">{{ currentLanguage.pageTitles.questionBank }}</title>
    <script src="vue.js"></script>
    <script src="i18n.js"></script>
    <style>
        /* 基础样式 */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
            margin: 0;
        }
        
        .management-container {
            max-width: 1200px;
            margin: 0 auto 20px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .import-export-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        #fileImport {
            display: none;
        }
        
        .question-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: bold;
            font-size: 14px;
        }
        
        .form-control {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        .question-list {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .question-item {
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 4px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .question-item .question-text {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .question-item .question-type {
            display: inline-block;
            padding: 3px 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 10px;
        }

        .question-item .question-type.single {
            background-color: #2196F3;
            color: #ffffff;
        }

        .question-item .question-type.multi {
            background-color: #4CAF50;
            color: #ffffff;
        }
        
        .question-item .options-list {
            margin-left: 20px;
            margin-bottom: 10px;
        }
        
        .question-item .action-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .question-item .action-btn {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .exam-controls {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: #2196F3;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0b7dda;
        }
        
        .btn-warning {
            background-color: #f57c00;
            color: #ffffff;
        }
        
        .btn-warning:hover {
            background-color: #ef6c00;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }

        /* 选项管理样式 */
        .options-container {
            margin-bottom: 15px;
        }
        
        .option-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .option-group input {
            flex: 1;
        }
        
        .remove-option {
            padding: 8px 12px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .add-option-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* 编辑问题模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            text-align: center;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        #editQuestionModal .modal-content {
            width: 600px;
            max-width: 90%;
            text-align: left;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .modal-backdrop.active {
            display: block;
        }

        /* 语言切换样式 */
        .language-switch {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .language-switch select {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .action-buttons {
                flex-wrap: wrap;
                gap: 10px;
            }

            .question-item .action-buttons {
                position: static;
                margin-top: 10px;
            }
            
            /* 响应式语言切换 */
            .header-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="management-container">
            <!-- 返回主页按钮和语言切换 -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;" class="header-controls">
                <div class="language-switch">
                    <label for="languageSelect">{{ currentLanguage.languageSwitch.label }}:</label>
                    <select id="languageSelect" v-model="currentLang" @change="switchLanguage">
                        <option value="zh">{{ currentLanguage.languageSwitch.zh }}</option>
                        <option value="en">{{ currentLanguage.languageSwitch.en }}</option>
                    </select>
                </div>
                <a href="index2.html" class="btn btn-primary">{{ currentLanguage.common.backToHome }}</a>
            </div>
            <h2>{{ currentLanguage.questionBankPage.title }}</h2>
            
            <div class="import-export-controls">
                <button class="btn btn-primary" @click="exportQuestionBank">{{ currentLanguage.questionBankPage.importExport.export }}</button>
                <label for="fileImport" class="btn btn-warning">{{ currentLanguage.questionBankPage.importExport.import }}</label>
                <input type="file" id="fileImport" accept=".json" @change="importQuestionBank">
                <button class="btn btn-danger" @click="clearAllQuestions">{{ currentLanguage.questionBankPage.importExport.clear }}</button>
                <button class="btn btn-primary" id="startExamBtn" :disabled="questionBank.length === 0" @click="startExam">{{ currentLanguage.homePage.startExam.button }}</button>
            </div>
            
            <h3>{{ currentLanguage.questionBankPage.addQuestion }}</h3>
            <form class="question-form" @submit.prevent="addNewQuestion">
                <div class="form-group">
                    <label for="questionType">{{ currentLanguage.questionBankPage.questionType }}</label>
                    <select v-model="newQuestion.type" id="questionType" class="form-control" required>
                        <option value="single">{{ currentLanguage.questionBankPage.questionTypes.single }}</option>
                        <option value="multiple">{{ currentLanguage.questionBankPage.questionTypes.multiple }}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="questionText">{{ currentLanguage.questionBankPage.questionContent }}</label>
                    <textarea v-model="newQuestion.text" id="questionText" class="form-control" required placeholder="Enter question content..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>{{ currentLanguage.questionBankPage.options }}</label>
                    <div class="options-container" id="optionsContainerAdd">
                        <div class="option-group" v-for="(option, index) in newQuestion.options" :key="index">
                            <input type="text" v-model="newQuestion.options[index]" class="form-control" required :placeholder="currentLanguage.questionBankPage.optionPlaceholder.replace('{{ label }}', getOptionLabel(index))">
                            <button type="button" class="remove-option" @click="removeOption('new', index)" :disabled="newQuestion.options.length <= 2">×</button>
                        </div>
                    </div>
                    <button type="button" class="add-option-btn" @click="addOption('new')">{{ currentLanguage.questionBankPage.addOption }}</button>
                </div>
                
                <div class="form-group" id="correctAnswerGroup">
                    <label for="correctAnswer">{{ currentLanguage.questionBankPage.correctAnswer }}</label>
                    <input type="text" v-model="newQuestion.correctAnswerText" id="correctAnswer" class="form-control" required :placeholder="currentLanguage.questionBankPage.correctAnswerPlaceholder">
                </div>
                
                <button type="submit" class="btn btn-primary">{{ currentLanguage.questionBankPage.addQuestion }}</button>
            </form>
            
            <h3 style="margin-top: 30px;" v-html="currentLanguage.questionBankPage.addedQuestions.replace('{count}', questionBank.length)"></h3>
            <div class="question-list" id="questionList">
                <p v-if="questionBank.length === 0">{{ currentLanguage.questionBankPage.noQuestions }}</p>
                <div v-else class="question-item" v-for="question in questionBank" :key="question.id">
                    <div class="question-type" :class="question.type">{{ question.type === 'single' ? currentLanguage.questionBankPage.questionTypes.single : currentLanguage.questionBankPage.questionTypes.multiple }}</div>
                    <div class="question-text">{{ question.text }}</div>
                    <div class="options-list">
                        <div v-for="(value, key) in question.options" :key="key">
                            <strong>{{ key }}.</strong> {{ value }}
                        </div>
                    </div>
                    <div><strong>Correct Answer:</strong> {{ formatCorrectAnswer(question) }}</div>
                    <div class="action-buttons">
                        <button class="btn btn-primary action-btn" @click="editQuestion(question)">Edit</button>
                        <button class="btn btn-danger action-btn" @click="deleteQuestion(question.id)">Delete</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 编辑问题模态框 -->
        <div class="modal-backdrop" :class="{ 'active': editModalVisible }" @click="closeEditModal"></div>
        <div class="modal" id="editQuestionModal" :class="{ 'active': editModalVisible }">
            <div class="modal-content">
                <h3>{{ currentLanguage.questionBankPage.editQuestion }}</h3>
                <form class="question-form" @submit.prevent="saveEditedQuestion">
                    <div class="form-group">
                        <label for="editQuestionType">{{ currentLanguage.questionBankPage.questionType }}</label>
                    <select v-model="editingQuestion.type" id="editQuestionType" class="form-control" required>
                        <option value="single">{{ currentLanguage.questionBankPage.questionTypes.single }}</option>
                        <option value="multiple">{{ currentLanguage.questionBankPage.questionTypes.multiple }}</option>
                    </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editQuestionText">{{ currentLanguage.questionBankPage.questionContent }}</label>
                    <textarea v-model="editingQuestion.text" id="editQuestionText" class="form-control" required placeholder="Enter question content..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>{{ currentLanguage.questionBankPage.options }}</label>
                        <div class="options-container" id="optionsContainerEdit">
                            <div class="option-group" v-for="(option, index) in editingQuestion.options" :key="index">
                                <input type="text" v-model="editingQuestion.options[index]" class="form-control" required :placeholder="currentLanguage.questionBankPage.optionPlaceholder.replace('{{ label }}', getOptionLabel(index))">
                                <button type="button" class="remove-option" @click="removeOption('edit', index)" :disabled="editingQuestion.options.length <= 2">×</button>
                            </div>
                        </div>
                        <button type="button" class="add-option-btn" @click="addOption('edit')">{{ currentLanguage.questionBankPage.addOption }}</button>
                    </div>
                    
                    <div class="form-group" id="editCorrectAnswerGroup">
                    <label for="editCorrectAnswer">{{ currentLanguage.questionBankPage.correctAnswer }}</label>
                    <input type="text" v-model="editingQuestion.correctAnswerText" id="editCorrectAnswer" class="form-control" required :placeholder="currentLanguage.questionBankPage.correctAnswerPlaceholder">
                </div>
                    
                    <div class="modal-buttons">
                        <button type="button" class="btn btn-primary" @click="closeEditModal">{{ currentLanguage.common.cancel }}</button>
                        <button type="submit" class="btn btn-primary">{{ currentLanguage.questionBankPage.saveChanges }}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // 检查考试是否正在进行中
        window.addEventListener('DOMContentLoaded', () => {
            const examInProgress = localStorage.getItem('examInProgress');
            if (examInProgress === 'true') {
                // 直接使用中文提示，因为此时Vue实例尚未初始化
                alert('考试正在进行中，无法访问题库管理页面！');
                window.location.href = 'exam2.html';
            }
        });

        new Vue({
            el: '#app',
            data: {
                questionBank: [],
                newQuestion: {
                    type: 'single',
                    text: '',
                    options: ['', '', '', ''],
                    correctAnswerText: ''
                },
                editModalVisible: false,
                editingQuestionId: '',
                editingQuestion: {
                    type: 'single',
                    text: '',
                    options: [],
                    correctAnswerText: ''
                },
                currentLang: 'zh'
            },
            computed: {
                currentLanguage() {
                    return languageResources[this.currentLang] || languageResources.zh;
                }
            },
            methods: {
                getOptionLabel(index) {
                    return String.fromCharCode(65 + index);
                },
                
                addOption(scope) {
                    if (scope === 'new') {
                        this.newQuestion.options.push('');
                    } else {
                        this.editingQuestion.options.push('');
                    }
                },
                
                removeOption(scope, index) {
                    if (scope === 'new') {
                        if (this.newQuestion.options.length > 2) {
                            this.newQuestion.options.splice(index, 1);
                        }
                    } else {
                        if (this.editingQuestion.options.length > 2) {
                            this.editingQuestion.options.splice(index, 1);
                        }
                    }
                },
                
                addNewQuestion() {
                    // 验证问题内容
                    if (!this.newQuestion.text.trim()) {
                        alert(this.currentLang === 'zh' ? '请输入问题内容。' : 'Please enter question content.');
                        return;
                    }
                    
                    // 收集有效选项
                    const validOptions = this.newQuestion.options.filter(opt => opt.trim() !== '');
                    if (validOptions.length < 2) {
                        alert(this.currentLang === 'zh' ? '请添加至少2个选项。' : 'Please add at least 2 options.');
                        return;
                    }
                    
                    // 转换选项为对象格式 {A: 'optionA', B: 'optionB', ...}
                    const options = {};
                    const optionLabels = [];
                    validOptions.forEach((opt, index) => {
                        const label = this.getOptionLabel(index);
                        options[label] = opt.trim();
                        optionLabels.push(label);
                    });
                    
                    // 处理并验证正确答案
                    let correctAnswer;
                    if (this.newQuestion.type === 'multiple') {
                        correctAnswer = this.newQuestion.correctAnswerText.split(',').map(ans => ans.trim().toUpperCase()).filter(ans => ans);
                        
                        // 验证所有答案都在可用选项中
                        const invalidAnswers = correctAnswer.filter(ans => !optionLabels.includes(ans));
                        if (invalidAnswers.length > 0) {
                            const message = this.currentLang === 'zh' 
                                ? `无效答案: ${invalidAnswers.join(', ')}。请仅使用可用的选项标签 (${optionLabels.join(', ')}).`
                                : `Invalid answer(s): ${invalidAnswers.join(', ')}. Please use only available option labels (${optionLabels.join(', ')}).`;
                            alert(message);
                            return;
                        }
                        
                        // 验证至少有一个正确答案
                        if (correctAnswer.length === 0) {
                            const message = this.currentLang === 'zh' 
                                ? '请为多选题提供至少一个正确答案。'
                                : 'Please provide at least one correct answer for multiple choice questions.';
                            alert(message);
                            return;
                        }
                        
                        correctAnswer = correctAnswer.sort();
                    } else {
                        correctAnswer = this.newQuestion.correctAnswerText.trim().toUpperCase();
                        
                        // 验证答案在可用选项中
                        if (!optionLabels.includes(correctAnswer)) {
                            const message = this.currentLang === 'zh' 
                                ? `无效答案。请仅使用可用的选项标签 (${optionLabels.join(', ')}).`
                                : `Invalid answer. Please use only available option labels (${optionLabels.join(', ')}).`;
                            alert(message);
                            return;
                        }
                    }
                    
                    // 创建新问题
                    const newQuestion = {
                        id: Date.now().toString(),
                        type: this.newQuestion.type,
                        text: this.newQuestion.text.trim(),
                        options: options,
                        correctAnswer: correctAnswer
                    };
                    
                    // 添加到题库
                    this.questionBank.push(newQuestion);
                    
                    // 保存并重置表单
                    this.saveQuestionBank();
                    this.resetNewQuestionForm();
                },
                
                resetNewQuestionForm() {
                    this.newQuestion = {
                        type: 'single',
                        text: '',
                        options: ['', '', '', ''],
                        correctAnswerText: ''
                    };
                },
                
                editQuestion(question) {
                    this.editingQuestionId = question.id;
                    this.editingQuestion = {
                        type: question.type,
                        text: question.text,
                        options: Object.values(question.options),
                        correctAnswerText: Array.isArray(question.correctAnswer) ? question.correctAnswer.join(', ') : question.correctAnswer
                    };
                    this.editModalVisible = true;
                },
                
                closeEditModal() {
                    this.editModalVisible = false;
                },
                
                saveEditedQuestion() {
                    // 验证问题内容
                    if (!this.editingQuestion.text.trim()) {
                        alert(this.currentLang === 'zh' ? '请输入问题内容。' : 'Please enter question content.');
                        return;
                    }
                    
                    // 收集有效选项
                    const validOptions = this.editingQuestion.options.filter(opt => opt.trim() !== '');
                    if (validOptions.length < 2) {
                        alert(this.currentLang === 'zh' ? '请添加至少2个选项。' : 'Please add at least 2 options.');
                        return;
                    }
                    
                    // 转换选项为对象格式 {A: 'optionA', B: 'optionB', ...}
                    const options = {};
                    const optionLabels = [];
                    validOptions.forEach((opt, index) => {
                        const label = this.getOptionLabel(index);
                        options[label] = opt.trim();
                        optionLabels.push(label);
                    });
                    
                    // 处理并验证正确答案
                    let correctAnswer;
                    if (this.editingQuestion.type === 'multiple') {
                        correctAnswer = this.editingQuestion.correctAnswerText.split(',').map(ans => ans.trim().toUpperCase()).filter(ans => ans);
                        
                        // 验证所有答案都在可用选项中
                        const invalidAnswers = correctAnswer.filter(ans => !optionLabels.includes(ans));
                        if (invalidAnswers.length > 0) {
                            const message = this.currentLang === 'zh' 
                                ? `无效答案: ${invalidAnswers.join(', ')}。请仅使用可用的选项标签 (${optionLabels.join(', ')}).`
                                : `Invalid answer(s): ${invalidAnswers.join(', ')}. Please use only available option labels (${optionLabels.join(', ')}).`;
                            alert(message);
                            return;
                        }
                        
                        // 验证至少有一个正确答案
                        if (correctAnswer.length === 0) {
                            const message = this.currentLang === 'zh' 
                                ? '请为多选题提供至少一个正确答案。' 
                                : 'Please provide at least one correct answer for multiple choice questions.';
                            alert(message);
                            return;
                        }
                        
                        correctAnswer = correctAnswer.sort();
                    } else {
                        correctAnswer = this.editingQuestion.correctAnswerText.trim().toUpperCase();
                        
                        // 验证答案在可用选项中
                        if (!optionLabels.includes(correctAnswer)) {
                            const message = this.currentLang === 'zh' 
                                ? `无效答案。请仅使用可用的选项标签 (${optionLabels.join(', ')}).`
                                : `Invalid answer. Please use only available option labels (${optionLabels.join(', ')}).`;
                            alert(message);
                            return;
                        }
                    }
                    
                    // 找到并更新问题
                    const questionIndex = this.questionBank.findIndex(q => q.id === this.editingQuestionId);
                    if (questionIndex !== -1) {
                        this.questionBank[questionIndex] = {
                            ...this.questionBank[questionIndex],
                            type: this.editingQuestion.type,
                            text: this.editingQuestion.text.trim(),
                            options: options,
                            correctAnswer: correctAnswer
                        };
                        
                        // 保存并关闭模态框
                        this.saveQuestionBank();
                        this.closeEditModal();
                    }
                },
                
                deleteQuestion(id) {
                    if (confirm(this.currentLang === 'zh' ? '您确定要删除这个问题吗？' : 'Are you sure you want to delete this question?')) {
                        this.questionBank = this.questionBank.filter(q => q.id !== id);
                        this.saveQuestionBank();
                    }
                },
                
                clearAllQuestions() {
                    if (this.questionBank.length === 0) {
                        alert(this.currentLang === 'zh' ? '没有问题可以清空' : 'No questions to clear');
                        return;
                    }
                    
                    if (confirm(this.currentLang === 'zh' ? '您确定要清空所有问题吗？此操作无法撤销。' : 'Are you sure you want to clear all questions? This action cannot be undone.')) {
                        this.questionBank = [];
                        this.saveQuestionBank();
                    }
                },
                
                exportQuestionBank() {
                    if (this.questionBank.length === 0) {
                        alert(this.currentLang === 'zh' ? '没有问题可以导出' : 'No questions to export');
                        return;
                    }
                    
                    // 提示用户将文件保存到QB文件夹
                    alert(this.currentLang === 'zh' ? '请在提示时将文件保存到QB文件夹。' : 'Please save the file to the QB folder when prompted.');
                    
                    const dataStr = JSON.stringify(this.questionBank, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    // 使用与现有题库文件一致的命名格式
                    const exportFileDefaultName = 'bw4h_2505_question_bank.json';
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                },
                
                importQuestionBank(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    // 验证文件类型
                    if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                        alert(this.currentLang === 'zh' ? '请选择JSON文件。' : 'Please select a JSON file.');
                        event.target.value = '';
                        return;
                    }
                    
                    // 验证文件名符合预期格式
                    if (!file.name.startsWith('bw4h_2505_question_bank')) {
                        alert(this.currentLang === 'zh' ? '请从QB文件夹中选择题库文件。预期文件名格式：bw4h_2505_question_bank.json' : 'Please select a question bank file from the QB folder. Expected filename format: bw4h_2505_question_bank.json');
                        event.target.value = '';
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedQuestions = JSON.parse(e.target.result);
                            
                            // 验证导入的数据格式
                            if (Array.isArray(importedQuestions) && importedQuestions.length > 0) {
                                this.questionBank = importedQuestions;
                                this.saveQuestionBank();
                                alert(this.currentLang === 'zh' ? `成功导入 ${importedQuestions.length} 个问题` : `Successfully imported ${importedQuestions.length} questions`);
                            } else {
                                alert(this.currentLang === 'zh' ? '无效的题库格式' : 'Invalid question bank format');
                            }
                        } catch (error) {
                            console.error('Failed to import question bank:', error);
                            alert(this.currentLang === 'zh' ? '导入题库失败。请检查文件格式。' : 'Failed to import question bank. Please check the file format.');
                        }
                    };
                    reader.readAsText(file);
                    
                    // 重置文件输入，允许重复选择同一个文件
                    event.target.value = '';
                },
                
                startExam() {
                    window.location.href = 'exam2.html';
                },
                
                saveQuestionBank() {
                    localStorage.setItem('examQuestionBank', JSON.stringify(this.questionBank));
                },
                
                loadQuestionBank() {
                    const savedQuestions = localStorage.getItem('examQuestionBank');
                    if (savedQuestions) {
                        try {
                            this.questionBank = JSON.parse(savedQuestions);
                        } catch (error) {
                            console.error('Failed to parse question bank from localStorage:', error);
                            localStorage.removeItem('examQuestionBank');
                        }
                    }
                },
                
                formatCorrectAnswer(question) {
                    return Array.isArray(question.correctAnswer) ? question.correctAnswer.join(', ') : question.correctAnswer;
                },
                
                switchLanguage() {
                    // 更新HTML的lang属性
                    document.documentElement.lang = this.currentLang;
                    
                    // 更新页面标题
                    document.getElementById('pageTitle').textContent = this.currentLanguage.pageTitles.questionBank;
                    
                    // 保存语言偏好到localStorage
                    localStorage.setItem('userLanguage', this.currentLang);
                }
            },
            mounted() {
                // 从localStorage加载用户语言偏好
                const savedLang = localStorage.getItem('userLanguage');
                if (savedLang && Object.keys(languageResources).includes(savedLang)) {
                    this.currentLang = savedLang;
                } else {
                    // 默认使用浏览器语言
                    const browserLang = navigator.language || navigator.userLanguage;
                    this.currentLang = browserLang.startsWith('zh') ? 'zh' : 'en';
                }
                
                // 应用语言设置
                this.switchLanguage();
                
                // 加载题库数据
                this.loadQuestionBank();
                
                // 使用nextTick确保DOM已经完全渲染
                this.$nextTick(() => {
                    // 检查题库是否为空
                    if (this.questionBank.length === 0) {
                        alert(this.currentLanguage.questionBankPage.noQuestions + ' Please import questions from the QB folder.');
                        
                        // 检查文件输入元素是否存在
                        const fileImportElement = document.getElementById('fileImport');
                        if (fileImportElement) {
                            // 直接触发文件选择对话框
                            fileImportElement.click();
                        } else {
                            console.error('fileImport element not found in DOM');
                            alert("Please click the 'Import Question Bank' button manually.");
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>